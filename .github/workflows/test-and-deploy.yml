name: test and deploy project
on:
  push:
    branches: ["final/usingCustomWorkflow"]
  workflow_dispatch:
jobs:
  compile-and-test:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: install node dependencies
        run: npm ci
      - name: run tests
        run: npm test
      # - name: Test Report
      #   uses: dorny/test-reporter@v1
      #   if: success() || failure() # run this step even if previous step failed
      #   with:
      #     name: JEST Tests # Name of the check run which will be created
      #     path: reports/jest-*.xml # Path to test results
      #     reporter: jest-junit # Format of test results
  build-deploy:
    runs-on: ubuntu-22.04
    needs: compile-and-test
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: setup git authentication 
        run: |
          git config --global user.email "andrew.miller348@gmail.com"
          git config --global user.name "andmill"
          git remote set-url origin https://andmill:${{ secrets.GITHUB_TOKEN }}@github.com/tst-mgmt/actions-demo-website
      - name: install node dependencies
        run: npm ci
      - name: build
        run: npm build
      - name: deploy to github pages
        run: npm deploy
